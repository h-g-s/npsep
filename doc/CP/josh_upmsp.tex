\documentclass{article}                    
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{picture}
\usepackage{hyperref}
\usepackage{rotating}
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
\usepackage{url}

\SetArgSty{textrm}

\begin{document}

\title{Constraint propagation and Backtracking}

\maketitle

\section{Definitions}

Each constraint $i$ of an Integer Program $\mathcal{P}$ can be written as one or two constraints in the form:

$$
\sum_{j\in N}a_{ij}x_j\leq b_i
$$
where $N$ is the index set of variables.

Considering that $N\stackrel{+}{i}=\left\{j\in N:a_{ij}>0\right\}$, $N\stackrel{-}{i}=\left\{j\in N:a_{ij}<0\right\}$ and $l_j$ and $u_j$ are the lower and upper bounds on $x_j$ , respectively, then the upper bound $U_{ij}$ for the left-hand side of constraint $i$ can be determined as:

$$
U_{i\hat{j}} = b_i - \sum_{j\in N\stackrel{+}{i}, j\neq \hat{j}}a_{ij}l_j + \sum_{j\in N\stackrel{-}{i}, j\neq \hat{j}}\left|a_{ij}\right|u_j 
$$

For each variable and constraint there may be a an implication which is computed in function $evaluateBound( \mathcal{P},l,u,i,j )$ where $i$ is a constraint index and $j$ is a variable index. Possible results for this function are: \texttt{CONFLICT}, if a conflict has been detected, \texttt{IMPLICATION} if a set of one or more implications was found and \texttt{NO\_IMPLICATION} if no implication could be obtained.

\begin{algorithm}[!h]
    \KwIn{$\mathcal{P},l,u,C$}
    \KwOut{$\left(status,F\right)$}
		$status \gets \texttt{NO\_IMPLICATION}$; $F\gets \emptyset $ \;
		\Repeat{$\left(C\neq0\right) and \left(new\_implication=true\right)$}{
		$new\_implication = false$;
		\\\ForAll {constraint $c$ in $C$} {
			\ForAll {variable $j$ not fixed in $c$} {
				\ $\left(status,bound\right)\gets evaluateBound\left(\mathcal{P},l,u,c,j\right)$;
				 \\\If{$\exists\left(j,b\right)\in F:b\neq bound$}{
						$return \left(\texttt{CONFLICT},F\right)$;
				}
				\Else{
						\If{$status =$ \texttt{FIX}}{
							$F\gets F\cup\left\{\left(j,bound\right)\right\}$;\\
							 $new\_implication = true$;
						}
						\ElseIf {$status = \texttt{CONFLICT}$}{
								$return \left(\texttt{CONFLICT},F\right)$;
						}
				}

			}
			
		}
		\If{$F=\emptyset$}{
			$return\ \left(\texttt{NO\_IMPLICATION},\emptyset\right)$;
		}
		
		\ForAll{$\left(j,bound\right)\in F$}{
				$l_j=u_j=bound$;
				\\\ForAll{$c \in C$ such that $a_{cj} \neq 0$ }{
					\If{$c$  has one or more unfixed variables}{
						$C\gets C \cup \left\{c\right\}$;
					}
				}		
		}\ForAll{$c\ in\ C$}{
				\If{all variables in $c$ are fixed}{
				        \If{$c$ is unfeasible}{
					        \Return \texttt{CONFLICT};
				        }
						$C\gets C \setminus  \left\{c\right\}$\;
				}
		}
	}
	
	\Return $\left(status,F\right)$\;	
		
    \caption{Constraint Propagation}
      \label{alg:sa}
\end{algorithm}

\begin{algorithm}[!h]
    \KwIn{$\mathcal{P},l,u,i,j$}
    \KwOut{$\left(status,bound\right)$}
		$U_{ij}\gets computeU(\mathcal{P},l,u,i,j)$\;
		$status\gets$ \texttt{NO\_IMPLICATION}; \,\, $bound\gets$ \texttt{NIL}\;
		\If{$ j\in N\stackrel{+}{i} $} {
			\If{$U_{ij}< 0$} {
					$status\gets\texttt{CONFLICT}$;
			}
			\ElseIf{$a_{ij}>U_{ij}$}{
			 $bound\gets 0$\;
			 $status\gets\texttt{FIX}$
			}
		}
		
		\If{$ j \in N\stackrel{-}{i} $} {
			\If{$a_{ij}>U_{ij}$} {
				$status\gets\texttt{CONFLICT}$;
			}
			\ElseIf{$U_{ij}< 0$}{
				 $bound\gets 1$\;
				$status\gets\texttt{FIX}$;
			}
		}
		\Return $(status,bound)$;
    \caption{evaluateBound}
      \label{alg:sa}
\end{algorithm}

\begin{algorithm}[!h]
    \KwIn{$LP\ instance,s\ Solution,l,u,v\ value,j\ variable$}
		${l_j=u_j\leftarrow\ v}$\;
			\If{$all\ variable\ are\ fixed$} {
					\If{$s\ is\ feasible$} {
						\If{$f\left(s\right) is\ better\ f\left(s^*\right)$} {
						$s^*\leftarrow s$\;
						$return$;
						}						
					}
					\Else{
						$return$;
					}
			}	
		$C\longleftarrow all\ constraints\ of\ j\ which\ have\ one\ or\ more\ unfixed\ variables$;
		\\ $\left(status,F\right)$ = Constraint\ propagation\ ({$lp,l,u,C$})\;
		\If{$status = \texttt{CONFLICT}$} {
				$return$;
		}
		\ElseIf{$status=\texttt{FIX}$} {
			\ForAll{$\left(j,bound\right)\in F$}{
				$l_j=u_j=bound$;
			}
		}
		\If{$all\ variable\ are\ fixed$} {
			\If{$f\left(s\right) is\ better\ f\left(s^*\right)$} {
					$s^*\leftarrow s$\;
					$return$;
			}						
		}
		$select\ one\ j'\ unfixed$;
		\\ BackTrack\ ({$lp,s,fix,lower,upper,1,j'$})\;
		 BackTrack\ ({$lp,s,fix,lower,upper,0,j'$})\;

    \caption{Backtrack}
      \label{alg:sa}
\end{algorithm}


%\input{tex/appendix2.tex}

\end{document}
